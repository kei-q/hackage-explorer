// Generated by CoffeeScript 1.6.2
(function() {
  var index_page_view, packageRactive, tag_page_view, tagsRactive;

  tagsRactive = function(data) {
    var tags;

    return tags = new Ractive({
      el: '#tags',
      template: '#tags_template',
      data: {
        items: data
      }
    });
  };

  packageRactive = function(data) {
    var packages;

    packages = new Ractive({
      el: '#packages',
      template: '#packages_template',
      data: {
        items: data,
        page: 1
      }
    });
    return packages.on({
      load_packages: function(event) {
        var next_page;

        next_page = event.context.page + 1;
        return $.get("/latest/" + next_page, function(data) {
          var i, v, _i, _len;

          for (i = _i = 0, _len = data.length; _i < _len; i = ++_i) {
            v = data[i];
            event.context.items.push(v);
          }
          return event.context.page = next_page;
        });
      }
    });
  };

  index_page_view = function(data) {
    return packageRactive(data);
  };

  tag_page_view = function(data) {
    var packages, tag;

    tag = new Ractive({
      el: '#tag_info',
      template: '#tag_template',
      data: data[0]
    });
    tag.on({
      edit: function(event) {
        return this.set('editing', true);
      },
      submit: function(event) {
        var id, synopsis,
          _this = this;

        id = event.context.key;
        synopsis = event.node.value;
        return $.post("/tag/synopsis", JSON.stringify([id, synopsis]), function(resp) {
          if (resp === true) {
            _this.set('value.synopsis', synopsis);
            return _this.set('editing', false);
          }
        });
      }
    });
    return packages = packageRactive(data[1]);
  };

  $(function() {
    var packages, tags;

    if ($('#page_index').size() === 1) {
      return index_page_view(data);
    } else if ($('#page_tag').size() === 1) {
      return tag_page_view(data);
    } else if ($('#page_search_tag').size() === 1) {
      return tags = tagsRactive(data);
    } else if ($('#page_search_package').size() === 1) {
      return packages = packageRactive(data);
    }
  });

}).call(this);
